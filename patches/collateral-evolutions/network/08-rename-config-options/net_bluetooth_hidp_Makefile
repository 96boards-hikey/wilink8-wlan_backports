--- a/net/bluetooth/hidp/Makefile
+++ b/net/bluetooth/hidp/Makefile
@@ -2,6 +2,6 @@
 # Makefile for the Linux Bluetooth HIDP layer
 #
 
-obj-$(CONFIG_BT_HIDP) += hidp.o
+obj-$(CONFIG_COMPAT_BT_HIDP) += hidp.o
 
 hidp-objs := core.o sock.o
