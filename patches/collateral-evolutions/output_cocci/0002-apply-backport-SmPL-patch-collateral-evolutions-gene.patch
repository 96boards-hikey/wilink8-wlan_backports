From d04a9357a4da567309514f4b63caa3992fdcd0f4 Mon Sep 17 00:00:00 2001
From: Eliad Peller <eliad@wizery.com>
Date: Mon, 15 Dec 2014 17:08:55 +0200
Subject: [PATCH 2/5] apply backport SmPL patch
 collateral-evolutions/generic/0001-group-attr/0002-group_attr_bus.cocci

---
 drivers/bcma/main.c | 10 ++++++++++
 drivers/ssb/main.c  | 10 ++++++++++
 2 files changed, 20 insertions(+)

diff --git a/drivers/bcma/main.c b/drivers/bcma/main.c
index 534e133..07f3a7d 100644
--- a/drivers/bcma/main.c
+++ b/drivers/bcma/main.c
@@ -62,7 +62,12 @@ static struct attribute *bcma_device_attrs[] = {
 	&dev_attr_class.attr,
 	NULL,
 };
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,12,0)
 ATTRIBUTE_GROUPS(bcma_device);
+#else
+#define BP_ATTR_GRP_STRUCT device_attribute
+ATTRIBUTE_GROUPS_BACKPORT(bcma_device);
+#endif
 
 static struct bus_type bcma_bus_type = {
 	.name		= "bcma",
@@ -70,7 +75,11 @@ static struct bus_type bcma_bus_type = {
 	.probe		= bcma_device_probe,
 	.remove		= bcma_device_remove,
 	.uevent		= bcma_device_uevent,
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,12,0)
 	.dev_groups	= bcma_device_groups,
+#else
+	.dev_attrs = bcma_device_dev_attrs,
+#endif
 };
 
 static u16 bcma_cc_core_id(struct bcma_bus *bus)
@@ -643,6 +652,7 @@ static int __init bcma_modinit(void)
 {
 	int err;
 
+	init_bcma_device_attrs();
 	err = bus_register(&bcma_bus_type);
 	if (err)
 		return err;
diff --git a/drivers/ssb/main.c b/drivers/ssb/main.c
index 2fead38..da5e86f 100644
--- a/drivers/ssb/main.c
+++ b/drivers/ssb/main.c
@@ -399,7 +399,12 @@ static struct attribute *ssb_device_attrs[] = {
 	&dev_attr_irq.attr,
 	NULL,
 };
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,12,0)
 ATTRIBUTE_GROUPS(ssb_device);
+#else
+#define BP_ATTR_GRP_STRUCT device_attribute
+ATTRIBUTE_GROUPS_BACKPORT(ssb_device);
+#endif
 
 static struct bus_type ssb_bustype = {
 	.name		= "ssb",
@@ -410,7 +415,11 @@ static struct bus_type ssb_bustype = {
 	.suspend	= ssb_device_suspend,
 	.resume		= ssb_device_resume,
 	.uevent		= ssb_device_uevent,
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,12,0)
 	.dev_groups	= ssb_device_groups,
+#else
+	.dev_attrs = ssb_device_dev_attrs,
+#endif
 };
 
 static void ssb_buses_lock(void)
@@ -1461,6 +1470,7 @@ static int __init ssb_modinit(void)
 
 	/* See the comment at the ssb_is_early_boot definition */
 	ssb_is_early_boot = 0;
+	init_ssb_device_attrs();
 	err = bus_register(&ssb_bustype);
 	if (err)
 		return err;
-- 
1.8.5.2.229.g4448466.dirty

